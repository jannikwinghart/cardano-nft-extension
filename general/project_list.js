
let custom_project_list = null
let project_list = null

default_project_list = {
  "0ldgranpas_Pinups": {
    "cnftio_name": null,
    "cnfttools_name": "0ldgranpaspinups",
    "cnftjungle_name": "38502",
    "opencnft_name": "M9qV0kXq5JUGN8kRM6p2uy3B2DkOr",
    "tokenref_name": null,
    "nftjam_name": null,
    "genesis_name": null,
    "override":false
  },
  "AdaSenshi Ninja": {
    "cnftio_name": null,
    "cnfttools_name": "adasenshi",
    "cnftjungle_name": "1171",
    "opencnft_name": "N9leAp6B8euOw9rqO9vZF9wkmY",
    "tokenref_name": "adasenshininja",
    "nftjam_name": null,
    "genesis_name": "153",
    "override":false
  },
  "Andels": {
    "cnftio_name": "Andels",
    "cnfttools_name": "andels",
    "cnftjungle_name": "27447",
    "opencnft_name": "d1aYq2D3lq",
    "tokenref_name": null,
    "nftjam_name": "andels",
    "genesis_name": "189",
    "override":false
  },
  "BabyAlienClub": {
    "cnftio_name": "BabyAlienClub",
    "cnfttools_name": "babyalienclub",
    "cnftjungle_name": "28222",
    "opencnft_name": "Oml5XyMyzGiOZmdJdMxVhw0",
    "tokenref_name": "babyalienclub",
    "nftjam_name": "baby-alien",
    "genesis_name": "50",
    "override":false
  },
  "Baby Dragon": {
    "cnftio_name": "Baby%20Dragon",
    "cnfttools_name": "babydragon",
    "cnftjungle_name": "33511",
    "opencnft_name": "p403vR6d1Mt5jo4ZGJ9",
    "tokenref_name": "babydragon",
    "nftjam_name": null,
    "genesis_name": "275",
    "override":false
  },
  "CardanoBeans": {
    "cnftio_name": "cardano-beans",
    "cnfttools_name": "cardanobeans",
    "cnftjungle_name": "8762",
    "opencnft_name": "LAERwnyXBJhGppdeB45M",
    "tokenref_name": "cardanobeans",
    "nftjam_name": null,
    "genesis_name": "437",
    "override":false
  },
  "CardanoCity": {
    "cnftio_name": "CardanoCity",
    "cnfttools_name": null,
    "cnftjungle_name": "21236",
    "opencnft_name": "GP2aXZGkrjt8PJYyPwO",
    "tokenref_name": null,
    "nftjam_name": null,
    "genesis_name": "53",
    "override":false
  },
  "CardanoKeys": {
    "cnftio_name": "CardanoKeys",
    "cnfttools_name": null,
    "cnftjungle_name": "589",
    "opencnft_name": "lOa2zDBJMwtQGz8Dq6Z",
    "tokenref_name": null,
    "nftjam_name": null,
    "genesis_name": "754",
    "override":false
  },
  "Clay Nation": {
    "cnftio_name": "Clay%20Nation%20by%20Clay%20Mates",
    "cnfttools_name": "claynation",
    "cnftjungle_name": "7867",
    "opencnft_name": "QL2anlZQ1AtR1qaqZxy2UAO3BZwp15TDMRQdY9X2trz",
    "tokenref_name": "claynation",
    "nftjam_name": "claynation",
    "genesis_name": "47",
    "override":false
  },
  "CryptoDino": {
    "cnftio_name": "CryptoDino",
    "cnfttools_name": "cryptodino",
    "cnftjungle_name": "2625",
    "opencnft_name": "2enDLjYQEdujEeY5z",
    "tokenref_name": "cryptodino",
    "nftjam_name": "crypto-dino",
    "genesis_name": "49",
    "override":false
  },
  "HighSteaksNFT": {
    "cnftio_name": "HighSteaksNFT",
    "cnfttools_name": "highsteaks",
    "cnftjungle_name": "28195",
    "opencnft_name": "d1w39rYxJQsVXMlXe1BafMj",
    "tokenref_name": null,
    "nftjam_name": null,
    "genesis_name": "203",
    "override":false
  },
  "HOSKY C(ash grab)NFT": {
    "cnftio_name": "HOSKY%20C(ash%20grab)NFT",
    "cnfttools_name": "hosky",
    "cnftjungle_name": "36912",
    "opencnft_name": "mzvN3Xr66lTp8R6O1PDru4PzEz0MXluvAG",
    "tokenref_name": "hoskynft",
    "nftjam_name": "hosky-cashgrab",
    "genesis_name": "2127",
    "override":false
  },
  "LionLegends": {
    "cnftio_name": "LionLegends",
    "cnfttools_name": "lionlegends",
    "cnftjungle_name": "34755",
    "opencnft_name": "0vqdJNqQPlH3O41AzoP",
    "tokenref_name": null,
    "nftjam_name": "lionlegends",
    "genesis_name": "484",
    "override":false
  },
  "Pavia": {
    "cnftio_name": "Pavia",
    "cnfttools_name": null,
    "cnftjungle_name": "7358",
    "opencnft_name": "p9J9ARGX4",
    "tokenref_name": null,
    "nftjam_name": "pavia",
    "genesis_name": "276",
    "override":false
  },
  "Rhino Generation": {
    "cnftio_name": "Rhino%20Generation",
    "cnfttools_name": "rhinogeneration",
    "cnftjungle_name": "9246",
    "opencnft_name": "Yx3aOkJLL7i1D4x6yyJqFXVexBN",
    "tokenref_name": "rhinogeneration",
    "nftjam_name": "rhino-generation",
    "genesis_name": "62",
    "override":false
  },
  "ShapesADA": {
    "cnftio_name": "ShapesADA",
    "cnfttools_name": null,
    "cnftjungle_name": "6926",
    "opencnft_name": null,
    "tokenref_name": "shapesada",
    "nftjam_name": null,
    "genesis_name": "40",
    "override":false
  },
  "TigerSociety Tigers": {
    "cnftio_name": "TigerSociety%20Tigers",
    "cnfttools_name": "tigersociety",
    "cnftjungle_name": "11439",
    "opencnft_name": "VNZ96VRVZOcDaG0a4OAmTm0MB4GOBQtJQ",
    "tokenref_name": null,
    "nftjam_name": null,
    "genesis_name": "168",
    "override":false
  },
  /*"": {
    "cnftio_name": "",
    "cnfttools_name": "",
    "cnftjungle_name": "",
    "opencnft_name": "",
    "nftjam_name": null,
    "genesis_name": "",
    "override":false
  },*/
}


function calculate_resulting_project_list(){
  merged_project_list = Object.assign({}, default_project_list);

  Object.entries(custom_project_list).forEach(([project_name, project_metadata]) => {
    console.log(project_name, project_metadata)

    if(project_name in default_project_list){
      // Project already exists in default_project_list
      if(project_metadata["override"]){
        // custom project metadata overrides default list
        merged_project_list[project_name] = project_metadata
      }else{
        // custom project metadata does not override default list
        null
      }
    }else{
      // Project does not exist in default_project_list
      merged_project_list[project_name] = project_metadata
    }
  })

  return merged_project_list
}

function load_custom_project_list(){
  return new Promise((resolve, reject) => {
    chrome.storage.sync.get("custom_project_list", (data) => {
      resolve(data["custom_project_list"])
    });
  });
}

function reload_project_list(){
  console.log("Reload project list")
  custom_project_list_promise = load_custom_project_list()
  project_list_promise = new Promise((resolve, reject) => {
    Promise.all([custom_project_list_promise]).then((data) => {
      if(data[0] == null){
        custom_project_list = {}
      } else {
        custom_project_list = data[0]
      }
      project_list = calculate_resulting_project_list()
      resolve(project_list)
    });
  })
  return project_list_promise
}
